<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui" xmlns:fr="http://java.sun.com/jsf/composite/fragments">

<ui:composition template="templates/templatePublic.xhtml">
	<ui:define name="pageName"> | View</ui:define>

    <ui:define name="mainContent">
        <ui:param name="paramAsset" value="#{param['a']}" />
        <ui:param name="paramSearch" value="#{param['q']}" />
        <ui:param name="paramSet" value="#{param['s']}" />
        <ui:param name="paramUser" value="#{param['u']}" />
        
        <div id="main">
            <!-- ASSETS -->
          	<ui:param name="asset" value="#{assetsController.fromParamter}" />
            
            <h:panelGroup layout="block" rendered="#{asset != null}">
           	    <ui:param name="set" value="#{setsController.getParent(asset)}" />
            
                <fr:breadcrumbs set="#{set}" />
                <section>
                    <!-- DOCUMENT -->
                    <h:panelGroup layout="block" rendered="#{asset.fileType == 'DOCUMENT'}">
                        <h1>DOCUMENT</h1>
                    </h:panelGroup>
                    <!-- IMAGE -->
                    <h:panelGroup layout="block" rendered="#{asset.fileType == 'IMAGE'}">
                        <p:lightBox id="lightbox">
                            <h:outputLink value="#{asset.streamURL}">
                                <img src="#{asset.streamURL}" title="#{asset.name}" alt="image asset" style="width: 100%" />
                            </h:outputLink>
                        </p:lightBox>
                    </h:panelGroup>
                    <!-- PDF -->
                    <h:panelGroup layout="block" rendered="#{asset.fileType == 'PDF'}">
                        <object type="application/pdf" data="#{asset.streamURL}" height="500" width="100%">
                            Your browser can't display pdf try to download the file instead.
                        </object>
                    </h:panelGroup>
                    <!-- VIDEO -->
                    <h:panelGroup layout="block" rendered="#{asset.fileType == 'VIDEO'}">
                        <video height="auto" width="100%" controls="true">
                            <source src="#{asset.streamURL}" type="video/ogg" />
                                Your browser does not support the video tag.
                        </video>
                    </h:panelGroup>
                    <!-- edit form -->
<!--                     <h:form id="metaContentForm"> -->
<!--                     	<p:inplace id="basic"> -->
<!--                      	  <p:inputTextarea value="...description..." maxlength="200" counterTemplate="({0})" autoResize="false" style="width: 99%;" /> -->
<!--                      	</p:inplace> -->
<!--                     </h:form> -->
                    <!-- other assets from set -->
                    <ui:param name="assets" value="#{assetsController.getOthersFrom(set, asset)}" />
                    <h:panelGroup layout="block" rendered="#{not empty assets}">
                        <div style="margin-top: 20px;" />
                        <fr:assetGrid assets="#{assets}" columns="4" rows="1" />
                    </h:panelGroup>
                </section>
                <aside>
                    <h2>
                        <h:outputText value="#{asset.name}" />
                    </h2>
                    <p>
                        <h:outputText class="ui-icon ui-icon-tag" title="meta content" rendered="#{asset.metaContent}" style="float: left;" />
                        <h:outputText value="#{asset.fileType}" />
                        <br />
                        <h:outputText value="#{asset.fileSize}" />
                        <br />
                        <h:outputText value="#{asset.timeStampFormatted}" />
                        <br />
                        <h:outputLink value="#{asset.streamURL}">direct link</h:outputLink>
                        <!-- <p:barcode value="#{asset.streamURL}" type="qr" width="50%"/> -->
                    </p>
                    <div style="margin-top: 20px;" />
                    <h:panelGroup layout="block" rendered="#{not empty asset.getMetaContent()}">
                        <h3>
                            <h:outputText value="meta content" />
                        </h3>
                        <p>
                            <h:outputText value="#{asset.metaContentFormatted}" style="white-space: pre-wrap" />
                        </p>
                    </h:panelGroup>
                </aside>
            </h:panelGroup>
             
            <!-- SEARCH -->
            <h:panelGroup layout="block" rendered="#{paramAsset == null and paramSet == null and paramSearch != null and paramUser == null}">
                <div align="center">
                    <ui:param name="relatedHashTags" value="#{hashTagsController.fromParamterOthers}" />
                
                    <h2>
                        <h:outputText value="#{param['q']}" />
                    </h2>
                    <h:panelGroup class="related" rendered="#{not empty relatedHashTags}" >
                        <ul>
                            <li>
                                <h:outputText value="related:"/>
                            </li>
                            <ui:repeat value="#{relatedHashTags}" var="hashTag">
                                <li>
                                    <h:outputLink value="#{hashTag.link}" title="search for #{hashTag.tag}">
                                        <h:outputText value="#{hashTag.tag}" />
                                    </h:outputLink>
                                </li>
                            </ui:repeat>
                        </ul>
                    </h:panelGroup>
                </div>
                <div style="margin-top: 20px;" />
                <fr:setGrid sets="#{hashTagsController.fromParamterSets}" />
            </h:panelGroup>
            
            <!-- SET -->
            <ui:param name="set" value="#{setsController.fromParamter}" />
            <h:panelGroup layout="block" rendered="#{set != null}">
                <ui:param name="materials" value="#{assetsController.getMaterialsFrom(set)}" />
                <ui:param name="metaContent" value="#{assetsController.getMetaContentFrom(set)}" />
                <ui:param name="childSets" value="#{setsController.getChilds(set)}" />
                <ui:param name="edit" value="true" />
                
                <fr:breadcrumbs set="#{set}" showSetName="true" />
                <h:panelGroup layout="block" rendered="#{not empty materials}">
               	    <fr:assetGrid assets="#{materials}" />
                </h:panelGroup>
                <h:panelGroup id="metaContentBlock" rendered="#{not empty set.metaContent}">
                    <ui:param name="owner" value="#{usersController.getEntry(set.ownerId)}" />
                
                    <div style="margin-top: 10px;" />
                    <div class="resource">
                        <h:panelGroup rendered="#{!edit}">
                            <h2 style="color:#333; font-size:1.5em; padding: 5px;"><h:outputText value="#{set.name}" /></h2>
                            <p style="font-size:1em; "><h:outputText value="#{set.metaContentFormatted}" escape="false" /></p>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{edit}">
                            <div style="float: right; padding: 5px;">
                                <p>
                                    <h:outputText value="#{set.timeStampFormatted}" />
                                    <h:outputText value=" | " rendered="#{owner != null}" />
                                    <h:outputLink id="owner" value="#{owner.link}" title="show all from #{owner.name}" rendered="#{owner != null}">
                                        <h:outputText value="@#{owner.name}" styleClass="outputLink" />
                                    </h:outputLink>
                                </p>
                            </div>
                        
                        	<div style="width: 65%;">
                                <p:inplace event="dblclick" editor="true">
                                    <f:facet name="output">
                                        <h2 style="color:#333; font-size:1.5em; padding: 5px;"><h:outputText value="#{set.name}" /></h2>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText id="name" required="true" requiredMessage="please enter a set name" value="#{set.name}" style="width: 96%;">
                                            <p:watermark for="name" value="set name..." />
                                        </p:inputText>
                                    </f:facet>
                                </p:inplace>
                                <p:inplace event="dblclick" editor="true">
                                    <f:facet name="output">
                                        <p style="font-size:1em; "><h:outputText value="#{set.metaContentFormatted}" escape="false" /></p>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputTextarea id="metaContent" required="true" requiredMessage="please enter some meta content" value="#{set.metaContent}" style="width: 98%; height: 40px">
                                            <p:watermark for="metaContent" value="meta content..." />
                                        </p:inputTextarea>
                                    </f:facet>
                                </p:inplace>
                            </div>
                            <div style="margin-top: 20px;" />
                            <p:commandButton value="private" icon="ui-icon ui-icon-locked" title="private" action="#{setsController.save(set.setState('PRIVATE'))}" update="metaContentBlock" disabled="#{set.state == 'PRIVATE'}" />
                            <p:commandButton value="published" icon="ui-icon ui-icon-unlocked" title="published" action="#{setsController.save(set.setState('PUBLISHED'))}" update="metaContentBlock" disabled="#{set.state == 'PUBLISHED'}" />
                            <p:commandButton value="public" icon="ui-icon ui-icon-extlink" title="public" action="#{setsController.save(set.setState('PUBLIC'))}" update="metaContentBlock" disabled="#{set.state == 'PUBLIC'}" />
                            <p:commandButton value="reset hash link" icon="ui-icon ui-icon-refresh" title="reset hash link" actionListener="#{setsController.save(set.resetHash())}" style="float:right;" />
                        </h:panelGroup>
                        <div style="clear: both;" />
                        <p:messages id="messages" autoUpdate="true" closable="true" showIcon="false" />
                    </div>
                </h:panelGroup>
                
                <h:panelGroup layout="block" rendered="#{not empty metaContent}">
                    <div style="margin-top: 10px;" />
                    <fr:assetGrid assets="#{metaContent}" printSize="true" rows="1" title="meta content" />
                </h:panelGroup>                
                <h:panelGroup layout="block" rendered="#{not empty childSets}">
                    <div style="margin-top: 10px;" />
                    <fr:setGrid sets="#{childSets}" printSize="true" rows="1" title="child sets" />
                </h:panelGroup>
            </h:panelGroup>
            
            <!-- USER -->
            <ui:param name="user" value="#{usersController.fromParamter}" />
            <ui:param name="sets" value="#{setsController.getRead(user)}" />
            
            <h:panelGroup layout="block" rendered="#{user != null and not empty sets}">
                <div align="center">
                    <h2>
                        <h:outputLink id="user" value="#{user.link}" title="show all from #{user.name}" rendered="#{user != null}">
               	            <h:outputText value="@#{user.name}" styleClass="outputLink" />
                        </h:outputLink>
                    </h2>
                </div>
                <div style="margin-top: 20px;" />
                <fr:setGrid sets="#{sets}" />
            </h:panelGroup>
        </div>
	</ui:define>
</ui:composition>
</html>